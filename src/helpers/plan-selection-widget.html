<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<dom-module id="plan-selection-widget">
    <template>
        <style include="shared-styles">
        :host {
            display: block;
            max-width: 400px;
            overflow: hidden;
        }
        #widget {
        }
        .plan-item {
            background-color: #eee;
            margin: 4px 0;
            padding: 4px 8px;
            text-transform: uppercase;
            text-align: center;
            cursor: pointer;
            border-radius: 3px;
        }
        .plans-list .plan-item {
            margin: 4px;
        }
        .plan-item.selected {
            background-color: green;
            color: #fff;
        }
        .check {
            opacity: 0.2;
        }
        .plan-item.selected  .check {
            opacity: 1;
        }
        .plan-item paper-icon-button::content iron-icon {
            transform: rotate(0);
            transition: transform 200ms ease-in;
        }
        .plan-item paper-icon-button.open::content iron-icon {
            transform: rotate(-90deg);
        }
        .plan-item.selected paper-icon-button::content iron-icon,
        .plan-item.selected iron-icon {
            color: #fff !important;
        }
        .plan-title {
            padding: 8px;
        }
        .plan-title > sub {
            text-transform: none;
            border-bottom: 1px solid;
            padding-bottom: 5px;
            width: 100%;
            display: block;
        }
        .details {
            padding: 0;
            text-transform: none;
            font-size: 0.9em;
            transform: translate(0, -10px);
            transition: transform 0ms ease-in;
            opacity: 0;
            height: 0;
        }
        .details.open {
            padding: 4px 8px;
            opacity: 1;
            height: auto;
            transform: translate(0, 0);
            transition: transform 200ms ease-in;
        }
        .view {
            height: auto;
            width: auto;
            overflow: hidden;
            transform: translate(0, 0);
            transition: all 200ms ease-out;
        }
        .view.slideleft {
            height: 0;
            width: 0;
            transform: translate(-100%, 0);
            transition: all 100ms ease-out;
        }
        .view.slideright {
            height: 0;
            width: 0;
            transform: translate(100%, 0);
            transition: all 100ms ease-out;
        }
        </style>

        <div id="widget" class="layout horizontal">

            <div id="viewMethod" class="view">
                Payment method:
                <div class$="plan-item [[_computeIsSelected('payg',selected)]]" on-tap="selectPayg">
                    <span class="check"><iron-icon icon="icons:check"></iron-icon></span>
                    Pay as you go 
                    <paper-icon-button id="paygIcon" icon="icons:expand-more" on-tap="_expand"></paper-icon-button>
                    <div id="paygDetails" class="details">
                        Free for up to 10 cpu cores, 100 datapoints/sec, 1000 rule checks/day, 10k API requests/day, 1 month retention
                    </div>
                </div>
                <div class$="plan-item [[prepaidIsSelected]]" on-tap="_togglePrepaid"> 
                    <span class="check"><iron-icon icon="icons:check"></iron-icon></span> Prepaid 
                    <span hidden$="[[!prepaidIsSelected]]">[[selected]]</span>
                    <paper-icon-button icon="icons:chevron-right"></paper-icon-button>
                </div>
            </div>

            <div id="viewPrepaid" class="view slideright">
                <paper-icon-button icon="icons:arrow-back" on-tap="_togglePrepaid"></paper-icon-button>
                Prepaid Plans:
                <div class="plans-list layout horizontal">
                    <div class$="plan-item [[_computeIsSelected('Small',selected)]]" on-tap="selectSmall"> 
                        <div class="plan-title"> Small<br/><sub>$200/mo</sub></div>
                        <div class="details open">
                            10 cpu cores<br/> 100 datapts/sec<br/> 1000 rule checks/day<br/> 1 month retention
                        </div>
                    </div> 
                    <div class$="plan-item [[_computeIsSelected('Medium',selected)]]" on-tap="selectMedium"> 
                        <div class="plan-title"> Medium<br/><sub>$700/mo</sub></div>
                        <div class="details open">
                            10 cpu cores<br/> 100 datapts/sec<br/> 1000 rule checks/day<br/> 1 month retention
                        </div>
                    </div> 
                    <div class$="plan-item [[_computeIsSelected('Large',selected)]]" on-tap="selectLarge"> 
                        <div class="plan-title"> Large<br/><sub>$3,000/mo</sub></div>
                        <div class="details open">
                            10 cpu cores<br/> 100 datapts/sec<br/> 1000 rule checks/day<br/> 1 month retention
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </template>
    <script>
        Polymer({
            is: 'plan-selection-widget',
            properties: {
                selected: String,
                prepaidIsSelected: {
                    type: Boolean,
                    computed: '_computePrepaidIsSelected(selected)'
                },
                plans: {
                    type: Array
                }
            },
            observers: [

            ],
            listeners: {

            },
            attached: function () {
                
            },
            _expand: function(e){
                e.stopImmediatePropagation();
                this.$.paygDetails.classList.toggle('open');
                this.$.paygIcon.classList.toggle('open');

                this.fire('refit');
            },
            _togglePrepaid: function(e){
                this.$.viewMethod.classList.toggle('slideleft');
                this.$.viewPrepaid.classList.toggle('slideright');

                this.fire('refit');
            },
            selectPayg: function(e){
                this.set('selected', 'payg');
            },
            _computePrepaidIsSelected: function(selected){
                return ['Small','Medium','Large'].indexOf(selected) > -1 ? 'selected' : '';
            },
            selectSmall: function(e){
                this.set('selected', 'Small');
                this.async(function(){this._togglePrepaid(e)}.bind(this), 200);
            },
            selectMedium: function(e){
                this.set('selected', 'Medium');
                this.async(function(){this._togglePrepaid(e)}.bind(this), 200);
            },
            selectLarge: function(e){
                this.set('selected', 'Large');
                this.async(function(){this._togglePrepaid(e)}.bind(this), 200);
            },
            _computeIsSelected: function(name, selected){
                return name === selected ? 'selected' : '';
            }
        });
    </script>
</dom-module>
