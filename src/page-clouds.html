<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/mist-list/mist-list.html">

<link rel="import" href="clouds/cloud-add.html">
<link rel="import" href="clouds/cloud-page.html">

<dom-module id="page-clouds">
  <template>
    <style>
       :host {
        display: block;
      }
    </style>

    <app-route route="{{route}}" pattern="/:cloud" data="{{data}}"></app-route>

    <template is="dom-if" if="[[_isListActive(route.path)]]" restamp>
      <mist-list 
        apiurl="/api/v1/clouds"
        selectable resizable column-menu multi-sort 
        items="[[model.cloudsArray]]" 
        selected-items="{{selectedItems}}"
        hidden$=[[!_isListActive(route.path)]]
        frozen=[[_getFrozenLogColumn()]]
        visible=[[_getVisibleColumns()]]>
          <p slot="no-items-found">No clouds found.</p>
      </mist-list>
    </template>
    <cloud-add providers="[[providers]]" keys="[[model.keysArray]]" section="[[model.sections.clouds]]" clouds="[[model.cloudsArray]]" enable-monitoring="[[enableMonitoring]]" enable-add-cloud="{{enableAddCloud}}" selected-plan="{{selectedPlan}}" hidden$=[[!_isAddPageActive(route.path)]]></cloud-add>
    <cloud-page model="[[model]]" cloud="[[_getCloud(data.cloud, model.clouds)]]" section="[[model.sections.clouds]]" hidden$=[[!_isDetailsPageActive(route.path)]]></cloud-page>

  </template>

  <script>
    Polymer({

      is: 'page-clouds',

      properties: {
        model: Object,
        data: Object,
        selectedItems: Array,
        enableMonitoring: Boolean,
        enableAddCloud: Boolean,
        selectedPlan: String,
        providers: {
          type: Object,
          value: PROVIDERS
        }
      },

      _getFrozenLogColumn: function() {
          return ['title'];
      },

      _getVisibleColumns: function(){
          return ['title', 'id', 'provider'];
      },

      _isAddPageActive: function (path) {
        return path == '/+add';
      },

      _isListActive: function (path) {
        return !path;
      },

      _isDetailsPageActive: function (path) {
        return path && path != '/+add';
      },
      _getCloud: function (id) {
        if (this.model.clouds)
          return this.model.clouds[id];
      }

    });
  </script>
</dom-module>